{% extends "base.html" %}

{% block content %}

<div class="container">
        <h1>Image: {{ image_name }}</h1>
        <a href="{{ image_path }}" target="_blank">
            <img src="{{ image_path }}" alt="Image not found" class="mb-3" width="300"/>
        </a>

        <form method="post" id="editForm">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Property</th>
                        <th>Prompt</th>
                        <th>Result1</th>
                        <th>Result2</th>
                        <th>Matches</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in records %}
                    <tr>
                        <td class="p-2">{{ row.property }}</td>
                        <td class="p-2">{{ row.prompt }}</td>
                        <td class="p-2">
                            <input class="form-control" name="result1_{{ loop.index0 }}"
                                   value="{{ row.result1 }}" onchange="updateMatch({{ loop.index0 }})"/>
                        </td>
                        <td class="p-2">
                            <input class="form-control" name="result2_{{ loop.index0 }}"
                                   value="{{ row.result2 }}" onchange="updateMatch({{ loop.index0 }})"/>
                        </td>
                        <td class="p-2">
                            <span id="match_{{ loop.index0 }}">
                                {{ row.result1 == row.result2 }}
                            </span>
                        </td>
                        <td class="p-2">
                            <input class="form-control" name="result_{{ loop.index0 }}"
                                   value="{{ row.result }}"/>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <button type="submit" class="btn btn-success">Save Changes</button>
        </form>

        <p class="mt-3">
            <a href="{{ url_for('view_dataset', dataset_id=dataset_id) }}" class="btn btn-secondary">Back to Dataset</a>
        </p>
    </div>

    <script>
        function updateMatch(index) {
            const r1 = document.querySelector(`input[name='result1_${index}']`).value.trim();
            const r2 = document.querySelector(`input[name='result2_${index}']`).value.trim();
            const matchElem = document.getElementById(`match_${index}`);
            matchElem.textContent = r1 === r2;
        }
    </script>

{% endblock %}